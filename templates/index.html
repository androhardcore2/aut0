<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Auto Video Creator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body class="bg-gray-100 min-h-screen p-8">
    <div class="max-w-4xl mx-auto bg-white rounded-lg shadow-lg p-6">
        <h1 class="text-3xl font-bold text-center mb-8">Auto Video Creator</h1>
        
        <!-- Text Generation -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">1. Generate Text Content</h2>
            <textarea id="prompt" class="w-full p-2 border rounded" rows="4" placeholder="Enter your prompt for text generation..."></textarea>
            <button onclick="generateText()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Generate Text</button>
            <div id="generatedText" class="mt-4 p-4 bg-gray-50 rounded hidden"></div>
        </div>

        <!-- Video Search -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">2. Search Stock Footage</h2>
            <input type="text" id="videoQuery" class="w-full p-2 border rounded" placeholder="Enter keywords for video search...">
            <button onclick="searchVideo()" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Search Video</button>
            <div id="videoPreview" class="mt-4 hidden">
                <video id="previewPlayer" class="w-full rounded" controls></video>
            </div>
        </div>

        <!-- Speech Generation -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">3. Generate Speech</h2>
            <button onclick="generateSpeech()" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">Generate Speech</button>
            <div id="audioPreview" class="mt-4 hidden">
                <audio id="previewAudio" class="w-full" controls></audio>
            </div>
        </div>

        <!-- Background Music -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">4. Background Music Options</h2>
            <div class="flex items-center space-x-4">
                <label class="inline-flex items-center">
                    <input type="checkbox" id="useBackgroundMusic" class="form-checkbox h-5 w-5 text-blue-600">
                    <span class="ml-2">Add background music</span>
                </label>
                <div class="flex items-center">
                    <label class="mr-2">Volume:</label>
                    <input type="range" id="bgMusicVolume" min="0" max="100" value="30" class="w-32">
                    <span id="volumeValue" class="ml-2">30%</span>
                </div>
            </div>
        </div>

        <!-- Video Creation -->
        <div class="mb-8">
            <h2 class="text-xl font-semibold mb-4">5. Create Final Video</h2>
            <button onclick="createVideo()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">Create Video</button>
            <div id="finalVideo" class="mt-4 hidden">
                <video id="finalPlayer" class="w-full rounded" controls></video>
                <a id="downloadLink" class="mt-2 inline-block bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600" download>Download Video</a>
            </div>
        </div>
    </div>

    <script>
        let generatedText = '';
        let videoPath = '';
        let audioPath = '';
        
        // Update volume display
        document.getElementById('bgMusicVolume').addEventListener('input', function(e) {
            document.getElementById('volumeValue').textContent = e.target.value + '%';
        });

        async function generateText() {
            const prompt = document.getElementById('prompt').value;
            if (!prompt) return;

            try {
                const response = await fetch('/generate-text', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ prompt })
                });

                const data = await response.json();
                if (data.text) {
                    generatedText = data.text;
                    const textDiv = document.getElementById('generatedText');
                    textDiv.textContent = data.text;
                    textDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to generate text');
            }
        }

        async function searchVideo() {
            const query = document.getElementById('videoQuery').value;
            if (!query) return;

            try {
                const response = await fetch('/download-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query })
                });

                const data = await response.json();
                if (data.path) {
                    videoPath = data.path;
                    const preview = document.getElementById('videoPreview');
                    const player = document.getElementById('previewPlayer');
                    player.src = `/download/${data.path.split('/').pop()}`;
                    preview.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to download video');
            }
        }

        async function generateSpeech() {
            if (!generatedText) {
                alert('Please generate text first');
                return;
            }

            try {
                const response = await fetch('/generate-speech', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ text: generatedText })
                });

                const data = await response.json();
                if (data.path) {
                    audioPath = data.path;
                    const preview = document.getElementById('audioPreview');
                    const audio = document.getElementById('previewAudio');
                    audio.src = `/download/${data.path.split('/').pop()}`;
                    preview.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to generate speech');
            }
        }

        async function createVideo() {
            if (!videoPath || !audioPath) {
                alert('Please ensure you have both video and audio ready');
                return;
            }

            const useBackgroundMusic = document.getElementById('useBackgroundMusic').checked;
            const bgVolume = document.getElementById('bgMusicVolume').value / 100;

            try {
                const response = await fetch('/create-video', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        video_path: videoPath,
                        audio_path: audioPath,
                        text_content: generatedText,
                        background_music: useBackgroundMusic ? 'yes' : 'no',
                        background_volume: bgVolume
                    })
                });

                const data = await response.json();
                if (data.path) {
                    const finalDiv = document.getElementById('finalVideo');
                    const player = document.getElementById('finalPlayer');
                    const downloadLink = document.getElementById('downloadLink');
                    const filename = data.path.split('/').pop();
                    
                    player.src = `/download/${filename}`;
                    downloadLink.href = `/download/${filename}`;
                    finalDiv.classList.remove('hidden');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to create video');
            }
        }
    </script>
</body>
</html>
